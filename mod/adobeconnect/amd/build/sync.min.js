define("mod_adobeconnect/sync",["exports","core/ajax","core/str","core/notification","core/templates"],(function(_exports,_ajax,_str,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);const Selectors_syncRecordings='[data-action="syncrecordings"]',Selectors_syncAttendance='[data-action="syncattendance"]',Selectors_deleteRecording='[data-action="deleterecording"]',Selectors_addToOfflineQueue='[data-action="addToOfflineQueue"]',Selectors_toggleDisplayOnline='[data-action="toggledisplayonline"]',Selectors_toggleDisplayOffline='[data-action="toggledisplayoffline"]',Selectors_toggleDisplayRow='[data-action="toggledisplayrow"]';let syncBoth=!1,syncRecordsDone=!1,syncAttendanceDone=!1;const registerEventListeners=(localized_strings,locale,contextId,scoid,groupmode,usrprincipal,showoffline)=>{document.addEventListener("click",(e=>{const syncRecordings=e.target.closest(Selectors_syncRecordings);syncRecordings&&(e.preventDefault(),syncBoth=!1,synchronizeRecords(localized_strings,locale,contextId,scoid,groupmode,usrprincipal,showoffline,syncRecordings));const syncAttendance=e.target.closest(Selectors_syncAttendance);syncAttendance&&(e.preventDefault(),syncBoth=!1,synchronizeAttendance(localized_strings,locale,contextId,scoid,groupmode,syncAttendance));const deleteRecording=e.target.closest(Selectors_deleteRecording);deleteRecording&&(e.preventDefault(),syncBoth=!1,deleteRecording.classList.add("loading"),_notification.default.confirm(localized_strings.delete,localized_strings.confirmdelete,localized_strings.yes,localized_strings.no,(function(){let query="#recording-"+deleteRecording.dataset.recordingid,row=document.querySelector(query);row.classList.add("disabled"),_ajax.default.call([{methodname:"adobeconnect_delete_recording",args:{cmid:contextId,recording_scoid:deleteRecording.dataset.recordingscoid,recording_id:deleteRecording.dataset.recordingid}}])[0].done((function(response){if(1!=response.status)return-1==response.status?_notification.default.alert("خطا",response.msg):showNotification(response,"success"),row.classList.remove("disabled"),void deleteRecording.classList.remove("loading");showNotification(response,"success"),row.parentNode.removeChild(row),deleteRecording.classList.remove("loading")})).fail((function(ex){row.classList.remove("disabled"),deleteRecording.classList.remove("loading"),_notification.default.exception(ex)}))}),(function(){deleteRecording.classList.remove("loading")})));const toggleDisplayOnline=e.target.closest(Selectors_toggleDisplayOnline),toggleDisplayOffline=e.target.closest(Selectors_toggleDisplayOffline);if(toggleDisplayOnline){if(e.preventDefault(),toggleDisplayOnline.classList.contains("disabled"))return;toggleDisplayOnline.classList.add("disabled");let ico=toggleDisplayOnline.querySelector("i");ico.classList.remove("fa-eye-slash"),ico.classList.remove("fa-eye"),ico.classList.add("spinner-grow"),_ajax.default.call([{methodname:"adobeconnect_hide_online",args:{cmid:contextId,recording_id:toggleDisplayOnline.dataset.recordingid,hide:toggleDisplayOnline.dataset.toggle}}])[0].done((function(response){1===response.status?0==toggleDisplayOnline.dataset.toggle?(ico.classList.remove("fa-eye-slash"),ico.classList.add("fa-eye"),ico.title=localized_strings.hide,ico.ariaLabel=localized_strings.hide,toggleDisplayOnline.dataset.toggle=1):(ico.classList.remove("fa-eye"),ico.classList.add("fa-eye-slash"),ico.title=localized_strings.show,ico.ariaLabel=localized_strings.show,toggleDisplayOnline.dataset.toggle=0):window.console.log(response.msg),toggleDisplayOnline.classList.remove("disabled"),ico.classList.remove("spinner-grow")})).fail((function(ex){_notification.default.exception(ex)}))}if(toggleDisplayOffline){if(e.preventDefault(),toggleDisplayOffline.classList.contains("disabled"))return;toggleDisplayOffline.classList.add("disabled");let ico=toggleDisplayOffline.querySelector("i");ico.classList.remove("fa-eye-slash"),ico.classList.remove("fa-eye"),ico.classList.add("spinner-grow"),_ajax.default.call([{methodname:"adobeconnect_hide_offline",args:{cmid:contextId,recording_id:toggleDisplayOffline.dataset.recordingid,hide:toggleDisplayOffline.dataset.toggle}}])[0].done((function(response){1===response.status?(0==toggleDisplayOffline.dataset.toggle?(ico.classList.remove("fa-eye-slash"),ico.classList.add("fa-eye"),ico.title=localized_strings.hide,ico.ariaLabel=localized_strings.hide,toggleDisplayOffline.dataset.toggle=1):(ico.classList.remove("fa-eye"),ico.classList.add("fa-eye-slash"),ico.title=localized_strings.show,ico.ariaLabel=localized_strings.show,toggleDisplayOffline.dataset.toggle=0),toggleDisplayOffline.classList.remove("disabled"),ico.classList.remove("spinner-grow")):window.console.log(response.msg)})).fail((function(ex){_notification.default.exception(ex)}))}const addToOfflineRecorder=e.target.closest(Selectors_addToOfflineQueue);addToOfflineRecorder&&(e.preventDefault(),syncBoth=!1,addToOfflineRecorder.classList.add("loading"),_notification.default.confirm(localized_strings.offliner,localized_strings.confirm_offline,localized_strings.yes,localized_strings.no,(function(){let query="#recording-"+addToOfflineRecorder.dataset.recordingid,row=document.querySelector(query);row.classList.add("disabled"),_ajax.default.call([{methodname:"adobeconnect_add_to_offline_queue",args:{cmid:contextId,recording_scoid:addToOfflineRecorder.dataset.recordingscoid,recording_id:addToOfflineRecorder.dataset.recordingid}}])[0].done((function(response){if(1!=response.status)return-1==response.status?_notification.default.alert("خطا",response.msg):showNotification(response,"success"),row.classList.remove("disabled"),void addToOfflineRecorder.classList.remove("loading");row.classList.remove("disabled"),showNotification(response,"success"),synchronizeRecords(localized_strings,locale,contextId,scoid,groupmode,usrprincipal,showoffline,syncRecordings)})).fail((function(ex){row.classList.remove("disabled"),addToOfflineRecorder.classList.remove("loading"),_notification.default.exception(ex)}))}),(function(){addToOfflineRecorder.classList.remove("loading")})));const toggleDisplayRow=e.target.closest(Selectors_toggleDisplayRow);if(toggleDisplayRow){if(e.preventDefault(),toggleDisplayRow.classList.contains("disabled"))return;let row=e.target.closest("tr"),toggleDisplayOnline=row.querySelector(Selectors_toggleDisplayOnline),toggleDisplayOffline=row.querySelector(Selectors_toggleDisplayOffline);toggleDisplayRow.classList.add("disabled"),toggleDisplayOnline.classList.add("disabled"),toggleDisplayOffline.classList.add("disabled");let ico=toggleDisplayRow.querySelector("i");ico.classList.remove("fa-eye-slash"),ico.classList.remove("fa-eye"),ico.classList.add("spinner-grow"),_ajax.default.call([{methodname:"adobeconnect_hide_recording",args:{cmid:contextId,recording_id:toggleDisplayRow.dataset.recordingid,hide:toggleDisplayRow.dataset.toggle}}])[0].done((function(response){if(1===response.status){let icoOnline=toggleDisplayOnline.querySelector("i"),icoOffline=toggleDisplayOffline.querySelector("i");0==toggleDisplayRow.dataset.toggle?(ico.classList.remove("fa-eye-slash"),ico.classList.add("fa-eye"),ico.title=localized_strings.hide,ico.ariaLabel=localized_strings.hide,icoOnline.classList.remove("fa-eye-slash"),icoOnline.classList.add("fa-eye"),icoOnline.title=localized_strings.hide,icoOnline.ariaLabel=localized_strings.hide,icoOffline.classList.remove("fa-eye-slash"),icoOffline.classList.add("fa-eye"),icoOffline.title=localized_strings.hide,icoOffline.ariaLabel=localized_strings.hide,toggleDisplayRow.dataset.toggle=1,toggleDisplayOnline.dataset.toggle=1,toggleDisplayOffline.dataset.toggle=1):(ico.classList.remove("fa-eye"),ico.classList.add("fa-eye-slash"),ico.title=localized_strings.show,ico.ariaLabel=localized_strings.show,icoOnline.classList.remove("fa-eye"),icoOnline.classList.add("fa-eye-slash"),icoOnline.title=localized_strings.show,icoOnline.ariaLabel=localized_strings.show,icoOffline.classList.remove("fa-eye"),icoOffline.classList.add("fa-eye-slash"),icoOffline.title=localized_strings.show,icoOffline.ariaLabel=localized_strings.show,toggleDisplayRow.dataset.toggle=0,toggleDisplayOnline.dataset.toggle=0,toggleDisplayOffline.dataset.toggle=0),toggleDisplayRow.classList.remove("disabled"),toggleDisplayOnline.classList.remove("disabled"),toggleDisplayOffline.classList.remove("disabled"),ico.classList.remove("spinner-grow")}else window.console.log(response.msg)})).fail((function(ex){_notification.default.exception(ex)}))}}))},synchronizeRecords=function(localized_strings,locale,contextId,scoid,groupmode,usrprincipal,showoffline){let syncRecordings=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,isAuto=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(toggleLoader(),!syncRecordings||!syncRecordings.classList.contains("loading")){syncRecordings||(syncRecordings=document.querySelector(Selectors_syncRecordings)),syncRecordings&&syncRecordings.classList.add("loading");var res=_ajax.default.call([{methodname:"adobeconnect_sync_recordings",args:{cmid:contextId,meetscoids:scoid,groupmode:groupmode,usrprincipal:usrprincipal,isAuto:isAuto}}]);res[0].done((function(response){if(-1==response.status&&_notification.default.alert("خطا",response.msg),0==response.status||-1==response.status)return toggleLoader("RECORDS",!1),syncRecordings&&syncRecordings.classList.remove("loading"),void showNotification(response);let json=null;try{json=JSON.parse(response.data)}catch(e){return _notification.default.exception(e),toggleLoader("RECORDS",!1),void(syncRecordings&&syncRecordings.classList.remove("loading"))}if(-2==response.status){toggleLoader("RECORDS",!1),syncRecordings&&syncRecordings.classList.remove("loading");let ele=document.getElementById("last_sync_record");return window.console.log(response.msg),void(ele&&(ele.innerHTML=json.last_sync))}json.records=generateRecordingsFields(json.records,groupmode,contextId),json.showoffline=showoffline,json.showoffline=showoffline,_templates.default.render("mod_adobeconnect/recordings",json).then(((html,js)=>{window.console.log("TEMPLATES");let table=document.querySelector("#records");_templates.default.replaceNode(table,html,js);let ele=document.getElementById("last_sync_record");window.console.log(response),ele&&(ele.innerHTML=json.last_sync),toggleLoader("RECORDS",!1),syncRecordings&&syncRecordings.classList.remove("loading"),showNotification(response)})).fail((e=>{syncRecordings&&syncRecordings.classList.remove("loading"),toggleLoader("RECORDS",!1),_notification.default.exception(e)}))})).fail((function(ex){syncRecordings&&syncRecordings.classList.remove("loading"),toggleLoader("RECORDS",!1),_notification.default.exception(ex)}))}},synchronizeAttendance=function(localized_strings,locale,contextId,scoid,groupmode){let syncAttendance=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,isAuto=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(toggleLoader(),!syncAttendance||!syncAttendance.classList.contains("loading")){syncAttendance||(syncAttendance=document.querySelector(Selectors_syncAttendance)),syncAttendance&&syncAttendance.classList.add("loading");var res=_ajax.default.call([{methodname:"adobeconnect_sync_attendances",args:{cmid:contextId,meetscoids:scoid,isAuto:isAuto}}]);res[0].done((function(response){if(-1==response.status&&_notification.default.alert("خطا",response.msg),0==response.status||-1==response.status)return toggleLoader("ATTENDANCE",!1),syncAttendance&&syncAttendance.classList.remove("loading"),void showNotification(response);let json=null;try{window.console.log(response),json=JSON.parse(response.data)}catch(e){return _notification.default.exception(e),toggleLoader("ATTENDANCE",!1),syncAttendance&&syncAttendance.classList.remove("loading"),void _notification.default.addNotification({message:"خطا در پاسخ دریافتی<br>",type:"error"})}if(-2!=response.status)_templates.default.render("mod_adobeconnect/attendance",json).then(((html,js)=>{let table=document.querySelector("#attendances");_templates.default.replaceNode(table,html,js);let ele=document.getElementById("last_sync_attendance");ele&&(ele.innerHTML=json.last_sync),toggleLoader("ATTENDANCE",!1),syncAttendance&&syncAttendance.classList.remove("loading"),showNotification(response,"success")})).fail((e=>{toggleLoader("ATTENDANCE",!1),syncAttendance&&syncAttendance.classList.remove("loading"),_notification.default.exception(e)}));else{toggleLoader("ATTENDANCE",!1),syncAttendance&&syncAttendance.classList.remove("loading"),showNotification(response);let ele=document.getElementById("last_sync_attendance");ele&&(ele.innerHTML=json.last_sync)}})).fail((function(ex){toggleLoader("ATTENDANCE",!1),syncAttendance&&syncAttendance.classList.remove("loading"),_notification.default.exception(ex)}))}},generateRecordingsFields=(items,groupid,contextId)=>{let arr_items=Array();return items.forEach((item=>{let row={};row.id=item.id;let url_online="joinrecording.php?mode=online&id="+contextId+"&recording="+item.recordingscoid+"&groupid="+groupid+"&sesskey="+item.sesskey,url_offline="joinrecording.php?mode=offline&id=".concat(contextId,"&recording=").concat(item.recordingscoid)+"&groupid=".concat(groupid,"&sesskey=").concat(item.sesskey);row.name=item.name,row.url=url_online,window.console.log(item.adobe_offline),row.url_offline=item.adobe_offline?url_offline:item.url_offline,row.adobe_offline=item.adobe_offline,row.recording_scoid=item.recordingscoid,row.recording_id=item.id,row.hideoffline=1==item.hideoffline?1:null,row.hideonline=1==item.hideonline?1:null,row.hiderow=1==item.hiderow?1:null,row.sesskey=item.sesskey,row.deleted=1==item.deleted?1:null,row.in_offline_server=1==item.in_offline_server?1:null,row.in_offline_queue=1==item.in_offline_queue?1:null,row.formated_create_date=item.formated_create_date,row.formated_duration=item.formated_duration,arr_items.push(row)})),arr_items},showNotification=function(response){let type=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";1===response.is_notification?_notification.default.addNotification({message:response.msg.replace(/\n/g,"<br>"),type:type}):(window.console.log("RESPONSE"),window.console.log(response))},toggleLoader=function(){let caller=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",show=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],loader=document.querySelector("#details-adobe .loader-full");show?(syncRecordsDone=!1,syncAttendanceDone=!1,loader.style.display="flex"):("RECORDS"===caller&&(syncRecordsDone=!0),"ATTENDANCE"===caller&&(syncAttendanceDone=!0),(syncAttendanceDone&&syncRecordsDone||!syncBoth)&&(loader.style.display="none"))};_exports.init=_ref=>{let{locale:locale,contextid:contextid,scoid:scoid,groupmode:groupmode,usrprincipal:usrprincipal,showoffline:showoffline,sync:sync}=_ref;var localized_strings=Array();localized_strings.delete="حذف",localized_strings.view="مشاهده",localized_strings.confirmdelete="آیا از حذف این کرورد اطمینان دارید؟",localized_strings.yes="بله",localized_strings.no="خیر",localized_strings.hide="پنهان کردن",localized_strings.show="نمایش",localized_strings.offliner="اضافه کردن به صف تبدیل",localized_strings.confirm_offline="آیا از اضافه کردن این جلسه برای تبدیل به فایل قابل دانلود اطمینان دارید؟",(0,_str.get_strings)([{key:"delete",component:"core"},{key:"view",component:"core"},{key:"confirmdelete",component:"mod_adobeconnect"},{key:"yes"},{key:"no"},{key:"hide"},{key:"show"},{key: "offliner", component: "mod_adobeconnect"},{key: "confirm_offline", component: "mod_adobeconnect"},]).done((function(s){localized_strings.delete=s[0],localized_strings.view=s[1],localized_strings.confirmdelete=s[2],localized_strings.yes=s[3],localized_strings.no=s[4],localized_strings.hide=s[5],localized_strings.show=s[6],localized_strings.offliner=s[7],localized_strings.confirm_offline=s[8],sync&&(syncBoth=!0,synchronizeRecords(localized_strings,locale,contextid,scoid,groupmode,usrprincipal,showoffline,null,!0),synchronizeAttendance(localized_strings,locale,contextid,scoid,groupmode,null,!0)),registerEventListeners(localized_strings,locale,contextid,scoid,groupmode,usrprincipal,showoffline)})).fail((function(e){_notification.default.exception(e),sync&&(syncBoth=!0,synchronizeRecords(localized_strings,locale,contextid,scoid,groupmode,usrprincipal,showoffline,null,!0),synchronizeAttendance(localized_strings,locale,contextid,scoid,groupmode,null,!0)),registerEventListeners(localized_strings,locale,contextid,scoid,groupmode,usrprincipal,showoffline)}))}}));

//# sourceMappingURL=sync.min.js.map
