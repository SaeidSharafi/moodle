/**
 * Javascript controller for the "Actions" panel at the bottom of the page.
 *
 * @module     auth_otp/otp
 * @copyright  2021 Brain station 23 <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.1
 */
define("auth_otp/otp",["jquery","core/ajax","core/notification","core/str"],(function($,Ajax,Notification,str){$("#sendotp").click((function(e){$("#sendotp").attr("disabled","disabled");var fullphone=$("#phone").val();$('input[name="full_number"]').val(fullphone);var phone=$("#phone").val();if(phone){if(/^09[0-9]{9}$/.test(fullphone)){let timerOn=!0;function timer(remaining){var m=Math.floor(remaining/60),s=remaining%60;m=m<10?"0"+m:m,s=s<10?"0"+s:s,document.getElementById("timer").innerHTML=m+":"+s,(remaining-=1)>=0&&timerOn?setTimeout((function(){timer(remaining)}),1e3):timerOn&&($("#sendotp").removeAttr("disabled"),document.getElementById("timer").innerHTML="Resend Code",$("#sendotp").removeClass("d-none"))}var request={methodname:"auth_otp_send_sms",args:{phone:phone}};try{Ajax.call([request])[0].done((function(data){1==data.success?($("#otp-field").removeClass("d-none"),$("#sendotp").attr("disabled","disabled"),$("#phone").attr("disabled","disabled"),$("#phone").val(phone),$("#username").val(data.username),timer(300),Notification.addNotification({message:data.message,type:"success"})):($("#sendotp").removeAttr("disabled"),Notification.addNotification({message:data.message,type:"error"}))})).fail(Notification.exception)}catch(e){console.log(e),$("#sendotp").removeAttr("disabled")}}else $("#sendotp").removeAttr("disabled"),str.get_string("invalidphonenumber","auth_otp").done((function(s){Notification.addNotification({message:s,type:"error"})})).fail(Notification.exception)}else $("#sendotp").removeAttr("disabled"),str.get_string("phonenumberempty","auth_otp").done((function(s){Notification.addNotification({message:s,type:"error"})})).fail(Notification.exception);return!1}))}));

//# sourceMappingURL=otp.min.js.map